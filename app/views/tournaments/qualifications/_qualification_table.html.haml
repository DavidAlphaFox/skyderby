%table.table.table-bordered.qualification-table
  %thead
    %tr
      %td{rowspan: 2}
        Rank
      %td{rowspan: 2}
        Competitor
      %td{rowspan: 2}
        Best result
      - @tournament.qualification_rounds.each do |round|
        %td.round-cell{colspan: 2}
          .round-cell__content
            = "Round #{round.order}"
            - if policy(@tournament).update?
              .round-cell__actions.dropdown
                %button.btn-link{'data-toggle': 'dropdown'}
                  %i.fa.fa-ellipsis-v
                %ul.dropdown-menu.dropdown-menu-right
                  %li
                    = button_to tournament_qualification_round_path(@tournament, round),
                                method: :delete,
                                remote: true,
                                class: 'btn-link' do
                      %i.fa.fa-times.text-muted
                      = t('general.delete')
    %tr
      - @tournament.qualification_rounds.each do |round|
        %td
          Result
        %td
          Canopy


  %tbody
    - qualification_results.each_with_index do |result, index|
      %tr
        %td= index + 1
        %td
          %a{href: profile_path(result[:profile_id])}
            = result[:name]
        %td= result[:best_result]
        - @tournament.qualification_rounds.each do |round|
          - round_result = result["round_#{round.order}"]
          - canopy_time = result["round_#{round.order}_canopy_time"]
          - track_id = result["round_#{round.order}_track_id"]
          - record_id = result["round_#{round.order}_result_id"]
          - if track_id
            %td.text-right
              %a{href: track_path(track_id), data: {toggle: 'tooltip'}, title: t('tournaments.show.show_details')}
                = round_result
              - if policy(@tournament).update?
                = link_to edit_tournament_qualification_jump_path(@tournament, record_id), remote: true do
                  %i.fa.fa-pencil.text-muted
            %td.text-right
              %span{'data-toggle' => 'tooltip', title: 'Canopy time'}
                = canopy_time
          - elsif round_result || !policy(@tournament).update?
            %td.text-right
              = round_result
            %td.text-right
              %span{'data-toggle' => 'tooltip', title: 'Canopy time'}
                = canopy_time
          - else
            %td.text-center.create-result-cell
              - if policy(@tournament).update?
                = link_to new_tournament_qualification_jump_path(@tournament), 
                          remote: true, 
                          'data-params': { 'qualification_jump[tournament_competitor_id]' => result[:id],
                                           'qualification_jump[qualification_round_id]' => round.id}.to_param,
                          class: 'create-result-cell__link',
                          rel: 'nofollow' do
                  %i.fa.fa-upload
            %td

